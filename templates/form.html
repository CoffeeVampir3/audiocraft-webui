<!DOCTYPE html>
<html>
<head>
    <title>Music Generator</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <style>
        /* Random Darker Color Palette */
        :root {
            --kangaroo: #b8a1a0;
            --flamingo: #b59a9a;
            --unicorn: #b87d9b;
            --platypus: #9f82bd;
            --raccoon: #b26c80;
            --tortoise: #b37884;
            --dinosaur: #ba8569;
            --yak: #baa778;
            --lizard: #82b37b;
            --chameleon: #73b2a8;
            --stingray: #6ca7b3;
            --narwhal: #5ca0b2;
            --dolphin: #6c8fb9;
            --jellyfish: #8b96bf;
            --cuttlefish: #9ba3b6;
            --walrus: #9299a3;
            --penguin: #7f8392;
            --meerkat: #73767e;
            --weasel: #626474;
            --mongoose: #54565c;
            --lemur: #464858;
            --opossum: #353645;
            --badger: #24242f;
            --kitten: #15151d;
            --puppy: #141417;
            --hamster: #0d0d0f;
        }
    
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--kitten);
            color: var(--cuttlefish);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
    
        select {
            background-color: var(--opossum);
            color: var(--cuttlefish);
        }
    
        textarea {
            background-color: var(--opossum);
            color: var(--cuttlefish);
        }
    
        .container {
            width: 90%; 
            background-color: var(--badger);
            padding: 3em;
            border-radius: 1em;
            box-shadow: 0px 5px 15px var(--weasel);
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
        }
    
        form {
            width: 100%; 
        }
    
        #advanced-settings,
        .audio-list {
            box-sizing: border-box; 
            padding: 1em;
            border: 1px solid var(--border-color);
            border-radius: 1em;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
            background-color: var(--ternary-background);
        }
    
        #advanced-settings {
            width: 60%;
            flex: 1;
            padding-top: 100px;
        }

        .audio-padding {
            height: 20px;
        }

        .audio-list {
            width: 50%;
            max-height: 70vh;
            height: 70vh;
            overflow-y: auto;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .audio-item {
            width:95%;
            max-width: 95%;
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid var(--hamster);
            border-radius: 5px;
            box-shadow: 0px 0px 5px var(--flamingo);
            justify-content: space-between;
        }

        .audio-list::-webkit-scrollbar {
            width: 10px;
        }

        .audio-list::-webkit-scrollbar-track {
            background: transparent;
        }

        .audio-list::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
        }

        .audio-item-text {
            max-width: 90%;
            overflow-wrap: break-word;
            text-align: left;
        }

        .field {
            margin-bottom: 2em;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin:auto;
        }
    
        .field label {
            display: block;
            margin-bottom: 0.5em;
            color: var(--light-text-color); 
            font-size: 1.2em;
            font-weight: 500;
        }
    
        .submit-container {
            flex-grow: 1;
            width: 100%;
            border: 1px solid var(--lemur);
            background-color: var(--badger);
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.2);
        }

        .input-wrapper {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .input-wrapper textarea {
            resize: none;
            margin-bottom: 10px;
        }

        .input-wrapper input[type="submit"] {
            align-self: flex-end;
            font-size: 1.2em;
            font-weight: bold;
        }

        .submit-container input[type="text"] {
            flex-grow: 1;
            margin-right: 1em;
            background-color: var(--opossum);
            border: none;
            border-radius: 0.25em;
            color: var(--cuttlefish);
            padding: 0.5em;
            transition: all 0.3s ease;
        }

        .submit-container input[type="submit"] {
            background-color: var(--flamingo);
            color: var(--kitten);
            border: none;
            padding: 0.25em 1.5em; 
            border-radius: 0.25em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-container input[type="submit"]:hover {
            background-color: var(--platypus);
        }

        .submit-container input[type="submit"]:active {
            background-color: var(--unicorn);
            transform: scale(0.95);
        }
    
        .group {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .slider-group {
            padding-bottom: 50px;
            padding-top: 50px;
        }
    
        .field {
            flex-basis: 100%;
        }
    
        .group > div {
            flex-basis: 50%;
        }
    </style>
    
    
</head>
<body>
    <div class="container">
        <form method="POST" enctype="multipart/form-data">
            <div id="advanced-settings">
                <div class="group">
                    <div class="field">
                        <label>{{ form.melody.label }}</label>
                        <input type="file" id="melody" name="melody" accept="audio/*">
                        <audio id="audio-preview" controls></audio>
                    </div>
                    <div class="field">
                        <label>{{ form.model.label }}</label>
                        {{ form.model }}
                    </div>
                </div>

                <div class="group slider-group">
                    <div>
                        <div class="field">
                            <label>{{ form.topk.label }}</label>
                            <input type="range" id="topk" name="topk" min="0" max="1000" value="{{ form.topk.data }}">
                            <span id="topk-value">{{ form.topk.data }}</span>
                        </div>
                        
                        <div class="field">
                            <label>{{ form.duration.label }}</label>
                            <input type="range" id="duration" name="duration" min="1" max="30" value="{{ form.duration.data }}">
                            <span id="duration-value">{{ form.duration.data }}</span>
                        </div>
                    </div>
                    <div>
                        <div class="field">
                            <label>{{ form.topp.label }}</label>
                            <input type="range" id="topp" name="topp" min="0" max="1" step="0.01" value="{{ form.topp.data }}">
                            <span id="topp-value">{{ form.topp.data }}</span>
                        </div>
                        <div class="field">
                            <label>{{ form.temperature.label }}</label>
                            <input type="range" id="temperature" name="temperature" min="0" max="7" step="0.01" value="{{ form.temperature.data }}">
                            <span id="temperature-value">{{ form.temperature.data }}</span>
                        </div>
                    </div>
                </div>                

                <div class="group">
                    <div class="submit-container">
                        <div class="input-wrapper">
                            <textarea id="text" name="text" rows="3" required=""></textarea>
                            <input id="submit" name="submit" type="submit" value="Submit">
                        </div>
                    </div>
                </div>
                
            </div>
        </form>

        <div class="audio-list">
            <div class="audio-padding"></div>  <!-- padding div -->
            {% for text, audio_file, _ in audio_files %}
                <div class="audio-item">
                    <div class="audio-item-text">
                        {{ text }}
                    </div>                    
                    <audio controls>
                        <source src="{{ url_for('static', filename='audio/' + audio_file) }}" type="audio/wav">
                    </audio>
                </div>
            {% endfor %}
            <div class="audio-padding"></div>  <!-- padding div -->
        </div>        

    </div>
</body>
<script>
    // Select sliders and corresponding output elements by id
    const durationSlider = document.querySelector('#duration');
    const durationOutput = document.querySelector('#duration-value');
    
    const toppSlider = document.querySelector('#topp');
    const toppOutput = document.querySelector('#topp-value');
    
    const temperatureSlider = document.querySelector('#temperature');
    const temperatureOutput = document.querySelector('#temperature-value');

    const topkSlider = document.querySelector('#topk');
    const topkOutput = document.querySelector('#topk-value');

    // Update the output element whenever the slider value changes
    durationSlider.oninput = function() {
        durationOutput.textContent = this.value;
    }

    toppSlider.oninput = function() {
        toppOutput.textContent = this.value;
    }

    temperatureSlider.oninput = function() {
        temperatureOutput.textContent = this.value;
    }

    topkSlider.oninput = function() {
        topkOutput.textContent = this.value;
    }

    document.getElementById("text").addEventListener("keydown", function(e) {
        if (e.keyCode === 13) {  // checks whether the pressed key is "Enter"
            e.preventDefault();  // prevent the default action (i.e., inserting a new line)
            document.getElementById("submit").click();  // trigger the submit button click event
        }
    });

</script>
</html>
